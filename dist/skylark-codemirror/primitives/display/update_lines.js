/**
 * skylark-codemirror - A version of codemirror 5.45  that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-codemirror/
 * @license MIT
 */
define(["../line/spans","../line/utils_line","../measurement/position_measurement","../util/browser"],function(e,t,i,n){"use strict";function l(e){if(e.widgets)for(let t=0;t<e.widgets.length;++t){let i=e.widgets[t],n=i.node.parentNode;n&&(i.height=n.offsetHeight)}}return{updateHeightsInViewport:function(e){let i=e.display,o=i.lineDiv.offsetTop;for(let s=0;s<i.view.length;s++){let r,h=i.view[s],a=e.options.lineWrapping,g=0;if(h.hidden)continue;if(n.ie&&n.ie_version<8){let e=h.node.offsetTop+h.node.offsetHeight;r=e-o,o=e}else{let e=h.node.getBoundingClientRect();r=e.bottom-e.top,!a&&h.text.firstChild&&(g=h.text.firstChild.getBoundingClientRect().right-e.left-1)}let p=h.line.height-r;if((p>.005||p<-.005)&&(t.updateLineHeight(h.line,r),l(h.line),h.rest))for(let e=0;e<h.rest.length;e++)l(h.rest[e]);if(g>e.display.sizerWidth){let t=Math.ceil(g/position_measurement.charWidth(e.display));t>e.display.maxLineLength&&(e.display.maxLineLength=t,e.display.maxLine=h.line,e.display.maxLineChanged=!0)}}},visibleLines:function(i,n,l){let o=l&&null!=l.top?Math.max(0,l.top):i.scroller.scrollTop;o=Math.floor(o-position_measurement.paddingTop(i));let s=l&&null!=l.bottom?l.bottom:o+i.wrapper.clientHeight,r=t.lineAtHeight(n,o),h=t.lineAtHeight(n,s);if(l&&l.ensure){let o=l.ensure.from.line,s=l.ensure.to.line;o<r?(r=o,h=t.lineAtHeight(n,e.heightAtLine(t.getLine(n,o))+i.wrapper.clientHeight)):Math.min(s,n.lastLine())>=h&&(r=t.lineAtHeight(n,e.heightAtLine(t.getLine(n,s))-i.wrapper.clientHeight),h=s)}return{from:r,to:Math.max(h,r+1)}}}});
//# sourceMappingURL=../../sourcemaps/primitives/display/update_lines.js.map
